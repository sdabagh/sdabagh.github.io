<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Tutor - Diagnostic Test</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="chat-styles.css">
    <style>
        #diagnostic-info {
            background: #FFF3CD;
            border: 2px solid #FFB020;
            padding: 20px;
            margin: 20px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 14px;
        }
        #diagnostic-info h3 {
            margin-top: 0;
            color: #856404;
        }
        .status-ok { color: #28A745; font-weight: bold; }
        .status-error { color: #D32F2F; font-weight: bold; }
    </style>
</head>
<body>

    <div style="max-width: 900px; margin: 0 auto; padding: 20px;">
        <h1>AI Tutor Diagnostic Test</h1>

        <div id="diagnostic-info">
            <h3>üîç Diagnostic Information</h3>
            <div id="diagnostic-output">Running diagnostics...</div>
        </div>

        <!-- Simplified chat interface for testing -->
        <div style="border: 2px solid #2C5F7C; border-radius: 8px; padding: 20px; background: white;">
            <h2>Test Chat Interface</h2>
            <div id="test-messages" style="min-height: 300px; max-height: 400px; overflow-y: auto;
                                           border: 1px solid #ddd; padding: 15px; margin-bottom: 15px;
                                           background: #F8F9FA;">
                <div style="padding: 10px; background: #E7F3FF; border-radius: 4px; margin-bottom: 10px;">
                    <strong>AI Tutor:</strong> Hi! I'm ready to help. Type a test message below.
                </div>
            </div>

            <form id="test-form" style="display: flex; gap: 10px;">
                <input type="text" id="test-input" placeholder="Type a test message..."
                       style="flex: 1; padding: 10px; border: 2px solid #2C5F7C; border-radius: 4px;">
                <button type="submit" style="padding: 10px 20px; background: #2C5F7C; color: white;
                                             border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">
                    Send Test
                </button>
            </form>
        </div>
    </div>

    <!-- Load scripts and run diagnostics -->
    <script>
        // Diagnostic function
        function runDiagnostics() {
            const output = document.getElementById('diagnostic-output');
            let html = '';

            // Test 1: Check if ScaffoldingEngine is defined
            html += '<div><strong>Test 1:</strong> ScaffoldingEngine class: ';
            if (typeof ScaffoldingEngine !== 'undefined') {
                html += '<span class="status-ok">‚úì LOADED</span></div>';
            } else {
                html += '<span class="status-error">‚úó NOT FOUND</span> (scaffolding-logic.js failed to load)</div>';
            }

            // Test 2: Check if SYSTEM_PROMPTS is defined
            html += '<div><strong>Test 2:</strong> SYSTEM_PROMPTS object: ';
            if (typeof SYSTEM_PROMPTS !== 'undefined') {
                html += '<span class="status-ok">‚úì LOADED</span></div>';
            } else {
                html += '<span class="status-error">‚úó NOT FOUND</span> (system-prompts.js failed to load)</div>';
            }

            // Test 3: Check if DEMO_RESPONSES is defined (from chat-interface.js)
            html += '<div><strong>Test 3:</strong> DEMO_RESPONSES: ';
            if (typeof DEMO_RESPONSES !== 'undefined') {
                html += '<span class="status-ok">‚úì LOADED</span></div>';
            } else {
                html += '<span class="status-error">‚úó NOT FOUND</span> (chat-interface.js not loaded or error)</div>';
            }

            // Test 4: Try creating ScaffoldingEngine instance
            html += '<div><strong>Test 4:</strong> Create ScaffoldingEngine instance: ';
            try {
                const testEngine = new ScaffoldingEngine();
                html += '<span class="status-ok">‚úì SUCCESS</span></div>';
                html += '<div style="margin-left: 20px;">‚Üí Current level: ' + testEngine.currentLevel + '</div>';
            } catch (error) {
                html += '<span class="status-error">‚úó FAILED</span></div>';
                html += '<div style="margin-left: 20px; color: #D32F2F;">Error: ' + error.message + '</div>';
            }

            // Test 5: Check browser console
            html += '<div style="margin-top: 15px;"><strong>Test 5:</strong> Check browser console for errors</div>';
            html += '<div style="margin-left: 20px;">Open DevTools (F12) and look at the Console tab</div>';

            // Test 6: Test demo response
            html += '<div style="margin-top: 15px;"><strong>Test 6:</strong> Demo Response Test: ';
            if (typeof DEMO_RESPONSES !== 'undefined' && DEMO_RESPONSES[1]) {
                html += '<span class="status-ok">‚úì AVAILABLE</span></div>';
                html += '<div style="margin-left: 20px;">Sample response: "' +
                        DEMO_RESPONSES[1].default.substring(0, 50) + '..."</div>';
            } else {
                html += '<span class="status-error">‚úó NOT AVAILABLE</span></div>';
            }

            output.innerHTML = html;
        }

        // Simple test chat
        document.getElementById('test-form').addEventListener('submit', function(e) {
            e.preventDefault();

            const input = document.getElementById('test-input');
            const messages = document.getElementById('test-messages');
            const userText = input.value.trim();

            if (!userText) return;

            // Add user message
            const userMsg = document.createElement('div');
            userMsg.style.cssText = 'padding: 10px; background: #D97D54; color: white; border-radius: 4px; margin-bottom: 10px; text-align: right;';
            userMsg.innerHTML = '<strong>You:</strong> ' + userText;
            messages.appendChild(userMsg);

            input.value = '';

            // Show typing indicator
            const typing = document.createElement('div');
            typing.id = 'typing';
            typing.style.cssText = 'padding: 10px; background: #E0E0E0; border-radius: 4px; margin-bottom: 10px; font-style: italic;';
            typing.textContent = 'AI is typing...';
            messages.appendChild(typing);
            messages.scrollTop = messages.scrollHeight;

            // Simulate response after delay
            setTimeout(() => {
                typing.remove();

                // Get demo response
                let responseText = "I received your message!";

                if (typeof DEMO_RESPONSES !== 'undefined' && DEMO_RESPONSES[1]) {
                    const lowerMsg = userText.toLowerCase();
                    if (lowerMsg.includes('mean') || lowerMsg.includes('average')) {
                        responseText = DEMO_RESPONSES[1].mean;
                    } else if (lowerMsg.includes('deviation') || lowerMsg.includes('spread')) {
                        responseText = DEMO_RESPONSES[1].deviation;
                    } else {
                        responseText = DEMO_RESPONSES[1].default;
                    }
                }

                const aiMsg = document.createElement('div');
                aiMsg.style.cssText = 'padding: 10px; background: #E7F3FF; border-radius: 4px; margin-bottom: 10px;';
                aiMsg.innerHTML = '<strong>AI:</strong> ' + responseText;
                messages.appendChild(aiMsg);
                messages.scrollTop = messages.scrollHeight;
            }, 1500);
        });
    </script>

    <!-- Load the AI tutor scripts -->
    <script src="system-prompts.js" onerror="console.error('Failed to load system-prompts.js')"></script>
    <script src="scaffolding-logic.js" onerror="console.error('Failed to load scaffolding-logic.js')"></script>
    <script src="chat-interface.js" onerror="console.error('Failed to load chat-interface.js')"></script>

    <!-- Run diagnostics after scripts load -->
    <script>
        window.addEventListener('load', () => {
            setTimeout(runDiagnostics, 100);
        });
    </script>

</body>
</html>
