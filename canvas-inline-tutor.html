<!--
  CANVAS AI TUTOR - Ultra-simplified for Canvas compatibility
  No complex CSS, uses basic HTML tables for layout
-->

<table style="width: 100%; max-width: 900px; border: 3px solid #2C5F7C; border-collapse: collapse; background: white; margin: 20px auto;">

<!-- Header Row -->
<tr>
  <td style="background: #2C5F7C; color: white; padding: 25px; text-align: center;">
    <h2 style="margin: 0; color: white; font-size: 26px;">ðŸ¤– AI Statistics Tutor</h2>
    <p style="margin: 8px 0 0 0; font-size: 15px; color: white;">Adaptive Support - Adjusts to Your Needs</p>
  </td>
</tr>

<!-- Level Indicator Row -->
<tr>
  <td style="background: #FFF9E6; padding: 15px; text-align: center; border-bottom: 2px solid #FFE082;">
    <strong style="font-size: 16px;">Support Level:</strong>
    <span id="ai-level-badge" style="background: #FFB020; color: white; padding: 8px 20px; border-radius: 20px; font-weight: bold; display: inline-block; margin-left: 10px;">Level 1 - Hints</span>
  </td>
</tr>

<!-- Chat Messages Row -->
<tr>
  <td style="padding: 0;">
    <div id="ai-messages" style="min-height: 450px; max-height: 550px; overflow-y: scroll; padding: 25px; background: #FAFBFC; border-bottom: 3px solid #E0E0E0;">

      <!-- Welcome Message -->
      <div style="background: #E7F3FF; border: 2px solid #90CAF9; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
        <p style="margin: 0 0 12px 0; font-size: 16px;"><strong>AI Tutor</strong></p>
        <p style="margin: 0 0 12px 0;">Welcome! I'm your AI statistics tutor. I'll adapt my responses based on your needs:</p>
        <ul style="margin: 8px 0; padding-left: 25px; line-height: 1.8;">
          <li><strong>Level 1:</strong> Hints and guiding questions</li>
          <li><strong>Level 2:</strong> Step-by-step breakdowns</li>
          <li><strong>Level 3:</strong> Complete worked examples</li>
        </ul>
        <p style="margin: 12px 0 0 0;"><strong>Ask me anything about statistics!</strong></p>
      </div>

    </div>
  </td>
</tr>

<!-- Input Row -->
<tr>
  <td style="padding: 20px; background: white;">
    <p style="margin: 0 0 12px 0; font-size: 16px;"><strong>Type your question below:</strong></p>

    <input type="text" id="ai-question-input" placeholder="Example: How do I calculate the mean?" style="width: 95%; padding: 15px; border: 3px solid #2C5F7C; border-radius: 8px; font-size: 17px; margin-bottom: 15px; display: block;">

    <button onclick="sendQuestion()" style="background: #2C5F7C; color: white; padding: 15px 40px; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 5px;">
      ðŸ’¬ Send Question
    </button>

    <p style="margin: 15px 0 0 0; font-size: 13px; color: #666;">
      ðŸ“Š <em>Research Note: Conversations are logged anonymously for dissertation research.</em>
    </p>
  </td>
</tr>

</table>

<script>
// Simple AI Tutor for Canvas
var level = 1;
var questionCount = 0;

var responses = {
  1: {
    default: "Let's think about this together. What's the first thing you notice about this problem?",
    mean: "Good question! What does 'mean' or 'average' represent? How would you calculate the center of a data set?",
    median: "Think about the median - it's the middle value. How would you find the middle of a sorted dataset?",
    mode: "The mode is the most frequent value. What if a dataset has two values that appear most often?",
    deviation: "Standard deviation measures spread. What's the relationship between variance and standard deviation?",
    variance: "Variance shows how spread out data is. How do we calculate it from the deviations?",
    confidence: "For confidence intervals, we need three key pieces. Can you identify what those might be?",
    test: "In hypothesis testing, what's the first step? Think about what we're trying to prove.",
    probability: "Let's think about probability. What does it mean for an event to have a certain probability?",
    correlation: "Correlation measures relationships. What's the difference between correlation and causation?",
    sample: "Think about sampling - why is random sampling important for statistical inference?",
    population: "A population is all members of a group. How is this different from a sample?"
  },
  2: {
    default: "Let me break this down:\n\n1. Identify the type of problem\n2. List what information we have\n3. Choose the right method\n\nLet's start with step 1 - what are you working on?",
    mean: "To calculate the mean:\n\n1. Add up all the values\n2. Count how many values you have\n3. Divide sum by count\n\nCan you try step 1 with your data?",
    median: "To find the median:\n\n1. Sort the data from smallest to largest\n2. If odd number of values, pick the middle one\n3. If even, average the two middle values\n\nHow many data points do you have?",
    mode: "To find the mode:\n\n1. Count how often each value appears\n2. Find the value(s) with highest frequency\n3. No mode if all values appear equally\n\nWhat are your data values?",
    deviation: "For standard deviation:\n\n1. Find the mean\n2. Subtract mean from each value\n3. Square those differences\n4. Find average of squared values (variance)\n5. Take square root\n\nWhich step are you stuck on?",
    variance: "To calculate variance:\n\n1. Find the mean\n2. Subtract mean from each value (deviations)\n3. Square each deviation\n4. Average all the squared deviations\n\nTry steps 1-2 first.",
    confidence: "Let's build a confidence interval:\n\n1. What are we estimating? (mean, proportion, etc.)\n2. What confidence level? (90%, 95%, 99%)\n3. Do we know population standard deviation?\n\nStart with question 1.",
    test: "Hypothesis test setup:\n\n1. State Hâ‚€ (null hypothesis)\n2. State Hâ‚ (alternative hypothesis)\n3. Choose significance level (Î±)\n4. Select the right test\n\nWhat would your Hâ‚€ be?",
    probability: "For probability problems:\n\n1. Identify the sample space\n2. Count favorable outcomes\n3. Count total possible outcomes\n4. Calculate P = favorable/total\n\nWhat's the sample space?",
    correlation: "To interpret correlation:\n\n1. Check the r value (-1 to +1)\n2. r near Â±1 = strong\n3. r near 0 = weak\n4. Sign shows direction\n\nWhat's your r value?",
    sample: "About sampling:\n\n1. Define your population\n2. Choose sampling method (random, stratified, etc.)\n3. Determine sample size\n4. Collect data\n\nWhat population are you studying?",
    population: "Population vs Sample:\n\n1. Population = entire group\n2. Sample = subset of population\n3. We study samples to learn about populations\n4. Randomness is key\n\nWhat are you trying to learn?"
  },
  3: {
    default: "COMPLETE EXAMPLE:\n\nProblem: Find 95% CI for mean\nGiven: n=36, xÌ„=78, s=12\n\nStep 1: z* = 1.96\nStep 2: SE = 12/âˆš36 = 2\nStep 3: ME = 1.96 Ã— 2 = 3.92\nStep 4: CI = 78 Â± 3.92\n\nANSWER: (74.08, 81.92)",
    mean: "MEAN EXAMPLE:\n\nData: 4, 7, 9, 12, 18\n\nStep 1: Sum = 4+7+9+12+18 = 50\nStep 2: Count = 5\nStep 3: Mean = 50Ã·5 = 10\n\nANSWER: Mean = 10",
    median: "MEDIAN EXAMPLE:\n\nData: 3, 7, 8, 12, 15\n\nStep 1: Already sorted âœ“\nStep 2: Count = 5 (odd)\nStep 3: Middle position = 3rd value\n\nANSWER: Median = 8",
    mode: "MODE EXAMPLE:\n\nData: 2, 3, 3, 5, 5, 5, 7, 9\n\nStep 1: Count frequencies\nâ€¢ 2 appears 1 time\nâ€¢ 3 appears 2 times\nâ€¢ 5 appears 3 times â† Most frequent\nâ€¢ 7,9 appear 1 time each\n\nANSWER: Mode = 5",
    deviation: "STANDARD DEVIATION:\n\nData: 2, 4, 6, 8, 10\n\nStep 1: Mean = 6\nStep 2: Deviations: -4,-2,0,2,4\nStep 3: Squared: 16,4,0,4,16\nStep 4: Variance = 40/5 = 8\nStep 5: SD = âˆš8 = 2.83\n\nANSWER: s = 2.83",
    variance: "VARIANCE EXAMPLE:\n\nData: 1, 3, 5, 7, 9\n\nStep 1: Mean = 5\nStep 2: Deviations:\nâ€¢ 1-5=-4, 3-5=-2, 5-5=0\nâ€¢ 7-5=2, 9-5=4\nStep 3: Squared: 16,4,0,4,16\nStep 4: Variance = 40/5 = 8\n\nANSWER: Variance = 8",
    confidence: "95% CI EXAMPLE:\n\nGiven: n=36, xÌ„=78, s=12\n\nStep 1: z* = 1.96 (for 95%)\nStep 2: SE = 12/âˆš36 = 2\nStep 3: ME = 1.96Ã—2 = 3.92\nStep 4: Lower = 74.08\nStep 5: Upper = 81.92\n\nANSWER: (74.08, 81.92)",
    test: "HYPOTHESIS TEST:\n\nTest if Î¼ > 65 (Î±=0.05)\nn=25, xÌ„=67, s=4\n\nStep 1: Hâ‚€:Î¼=65, Hâ‚:Î¼>65\nStep 2: Î± = 0.05\nStep 3: t = (67-65)/(4/5) = 2.5\nStep 4: t* = 1.711 (df=24)\nStep 5: 2.5>1.711 â†’ Reject Hâ‚€\n\nCONCLUSION: Î¼ > 65",
    probability: "PROBABILITY EXAMPLE:\n\nRoll 2 dice, find P(sum=7)\n\nStep 1: Total outcomes = 36\nStep 2: Favorable outcomes:\n(1,6)(2,5)(3,4)(4,3)(5,2)(6,1) = 6\nStep 3: P = 6/36 = 1/6\n\nANSWER: P = 0.167 or 16.7%",
    correlation: "CORRELATION EXAMPLE:\n\nGiven: r = 0.85\n\nStep 1: 0.85 is close to +1\nStep 2: STRONG correlation\nStep 3: Positive direction\nStep 4: rÂ² = 0.72 (72%)\n\nINTERPRETATION: Strong positive relationship",
    sample: "SAMPLING EXAMPLE:\n\nPopulation: 1000 students\nNeed: Representative sample\n\nStep 1: Random sampling\nStep 2: Sample size n=100\nStep 3: Each student has equal chance\nStep 4: Use random number generator\n\nRESULT: Unbiased sample of 100",
    population: "POPULATION vs SAMPLE:\n\nPopulation: All 50,000 college students in state\nSample: 500 randomly selected students\n\nWhy sample?\nâ€¢ Too expensive to survey all 50,000\nâ€¢ Sample of 500 is representative\nâ€¢ Can infer population characteristics\n\nKEY: Random selection is critical"
  }
};

function updateLevel() {
  questionCount++;
  if (questionCount >= 4) level = 3;
  else if (questionCount >= 2) level = 2;

  var labels = {1: 'Level 1 - Hints', 2: 'Level 2 - Guided Steps', 3: 'Level 3 - Worked Examples'};
  document.getElementById('ai-level-badge').textContent = labels[level];
}

function addMsg(role, text) {
  var container = document.getElementById('ai-messages');
  var box = document.createElement('div');

  if (role === 'user') {
    box.style.cssText = 'background: #D97D54; color: white; padding: 15px; border-radius: 10px; margin-bottom: 18px; margin-left: 18%; text-align: left;';
    box.innerHTML = '<p style="margin:0;"><strong>You:</strong></p><p style="margin:8px 0 0 0;">' + text + '</p>';
  } else {
    box.style.cssText = 'background: #E7F3FF; border: 2px solid #90CAF9; padding: 15px; border-radius: 10px; margin-bottom: 18px; margin-right: 18%;';
    box.innerHTML = '<p style="margin:0;"><strong>AI Tutor:</strong></p><p style="margin:8px 0 0 0; white-space:pre-wrap;">' + text + '</p>';
  }

  container.appendChild(box);
  container.scrollTop = container.scrollHeight;
}

function getAnswer(question) {
  var q = question.toLowerCase();
  var r = responses[level];

  if (q.indexOf('mean') >= 0 || q.indexOf('average') >= 0) return r.mean;
  if (q.indexOf('median') >= 0) return r.median;
  if (q.indexOf('mode') >= 0) return r.mode;
  if (q.indexOf('deviation') >= 0 || q.indexOf('spread') >= 0) return r.deviation;
  if (q.indexOf('variance') >= 0) return r.variance;
  if (q.indexOf('confidence') >= 0 || q.indexOf('interval') >= 0) return r.confidence;
  if (q.indexOf('test') >= 0 || q.indexOf('hypothesis') >= 0 || q.indexOf('null') >= 0) return r.test;
  if (q.indexOf('probability') >= 0 || q.indexOf('chance') >= 0) return r.probability;
  if (q.indexOf('correlation') >= 0 || q.indexOf('relationship') >= 0) return r.correlation;
  if (q.indexOf('sample') >= 0 || q.indexOf('sampling') >= 0) return r.sample;
  if (q.indexOf('population') >= 0) return r.population;
  return r.default;
}

function sendQuestion() {
  var input = document.getElementById('ai-question-input');
  var question = input.value.trim();

  if (!question) {
    alert('Please type a question first!');
    return;
  }

  // Show user message
  addMsg('user', question);
  input.value = '';
  input.disabled = true;

  // Update level
  updateLevel();

  // Get and show AI response
  setTimeout(function() {
    var answer = getAnswer(question);
    addMsg('ai', answer);
    input.disabled = false;
    input.focus();
  }, 800);
}

// Enter key support
document.getElementById('ai-question-input').onkeypress = function(e) {
  if (e.keyCode === 13) {
    sendQuestion();
  }
};

console.log('âœ“ AI Tutor ready!');
</script>
