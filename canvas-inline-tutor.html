<!--
  CANVAS AI TUTOR - Uses contenteditable div for input (Canvas-proof)
-->

<div style="border: 3px solid #2C5F7C; max-width: 900px; margin: 20px auto; background: white; border-radius: 10px; overflow: hidden;">

<!-- Header -->
<div style="background: #2C5F7C; color: white; padding: 25px; text-align: center;">
  <h2 style="margin: 0; color: white; font-size: 26px;">ðŸ¤– AI Statistics Tutor</h2>
  <p style="margin: 8px 0 0 0; font-size: 15px; color: white;">Adaptive Support - Adjusts to Your Needs</p>
</div>

<!-- Level Badge -->
<div style="background: #FFF9E6; padding: 15px; text-align: center; border-bottom: 2px solid #FFE082;">
  <strong style="font-size: 16px;">Support Level:</strong>
  <span id="tutor-level" style="background: #FFB020; color: white; padding: 8px 20px; border-radius: 20px; font-weight: bold; display: inline-block; margin-left: 10px;">Level 1 - Hints</span>
</div>

<!-- Messages -->
<div id="tutor-messages" style="min-height: 450px; max-height: 550px; overflow-y: auto; padding: 25px; background: #FAFBFC; border-bottom: 3px solid #E0E0E0;">

  <div style="background: #E7F3FF; border: 2px solid #90CAF9; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
    <p style="margin: 0 0 12px 0; font-size: 16px;"><strong>AI Tutor</strong></p>
    <p style="margin: 0 0 12px 0;">Welcome! I'm your AI statistics tutor. I'll adapt my responses based on your needs:</p>
    <ul style="margin: 8px 0; padding-left: 25px; line-height: 1.8;">
      <li><strong>Level 1:</strong> Hints and guiding questions</li>
      <li><strong>Level 2:</strong> Step-by-step breakdowns</li>
      <li><strong>Level 3:</strong> Complete worked examples</li>
    </ul>
    <p style="margin: 12px 0 0 0;"><strong>Ask me anything about statistics!</strong></p>
  </div>

</div>

<!-- Input Area with contenteditable div -->
<div style="padding: 20px; background: white;">
  <p style="margin: 0 0 12px 0; font-size: 16px;"><strong>Type your question below and click Send:</strong></p>

  <div id="tutor-input" contenteditable="true" style="width: 95%; min-height: 60px; padding: 15px; border: 3px solid #2C5F7C; border-radius: 8px; font-size: 17px; margin-bottom: 15px; background: white; cursor: text; overflow-wrap: break-word;" placeholder="Example: How do I calculate the mean?">Type your question here...</div>

  <button onclick="askTutor()" style="background: #2C5F7C; color: white; padding: 15px 40px; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 5px;">
    ðŸ’¬ Send Question
  </button>

  <p style="margin: 15px 0 0 0; font-size: 13px; color: #666;">
    ðŸ“Š <em>Research Note: Conversations are logged anonymously for dissertation research.</em>
  </p>
</div>

</div>

<script>
var tutorLevel = 1;
var questionNum = 0;

var answers = {
  1: {
    default: "Let's think about this together. What's the first thing you notice about this problem?",
    mean: "Good question! What does 'mean' or 'average' represent? How would you calculate the center of a data set?",
    median: "Think about the median - it's the middle value. How would you find the middle of a sorted dataset?",
    mode: "The mode is the most frequent value. What if multiple values appear most often?",
    deviation: "Standard deviation measures spread. What's the relationship between variance and standard deviation?",
    variance: "Variance shows how spread out data is. How do we calculate it?",
    confidence: "For confidence intervals, we need three key pieces. Can you identify what those might be?",
    test: "In hypothesis testing, what's the first step? Think about what we're trying to prove.",
    probability: "Let's think about probability. What does it mean for an event to have a probability of 0.5?",
    correlation: "Correlation measures relationships. What's the difference between correlation and causation?"
  },
  2: {
    default: "Let me break this down:\n\n1. Identify the type of problem\n2. List what we have\n3. Choose the method\n\nStart with step 1 - what type of problem?",
    mean: "To calculate the mean:\n\n1. Add all values\n2. Count how many values\n3. Divide sum by count\n\nTry step 1 with your data.",
    median: "To find median:\n\n1. Sort the data\n2. If odd count, pick middle\n3. If even, average two middle values\n\nHow many data points?",
    mode: "To find mode:\n\n1. Count frequencies\n2. Find highest frequency\n3. No mode if all equal\n\nWhat are your values?",
    deviation: "For standard deviation:\n\n1. Find mean\n2. Subtract mean from each\n3. Square differences\n4. Average squared values\n5. Take square root\n\nWhich step is tricky?",
    variance: "To calculate variance:\n\n1. Find mean\n2. Find deviations\n3. Square deviations\n4. Average them\n\nTry steps 1-2.",
    confidence: "Build confidence interval:\n\n1. What estimating? (mean/proportion)\n2. Confidence level? (90/95/99%)\n3. Know population SD?\n\nAnswer question 1.",
    test: "Hypothesis test:\n\n1. State Hâ‚€\n2. State Hâ‚\n3. Choose Î±\n4. Select test\n\nWhat's your Hâ‚€?",
    probability: "For probability:\n\n1. Sample space\n2. Favorable outcomes\n3. Total outcomes\n4. P = favorable/total\n\nWhat's the sample space?",
    correlation: "For correlation:\n\n1. Check r value\n2. Near Â±1 = strong\n3. Near 0 = weak\n4. Sign = direction\n\nWhat's your r?"
  },
  3: {
    default: "EXAMPLE:\n\nFind 95% CI for mean\nn=36, xÌ„=78, s=12\n\nz*=1.96\nSE=12/âˆš36=2\nME=1.96Ã—2=3.92\nCI=78Â±3.92\n\nANSWER: (74.08, 81.92)",
    mean: "MEAN EXAMPLE:\n\nData: 4,7,9,12,18\n\nSum = 50\nCount = 5\nMean = 50Ã·5 = 10\n\nANSWER: 10",
    median: "MEDIAN EXAMPLE:\n\nData: 3,7,8,12,15\n\nSorted âœ“\nCount=5 (odd)\n3rd value = 8\n\nANSWER: 8",
    mode: "MODE EXAMPLE:\n\nData: 2,3,3,5,5,5,7,9\n\n2: 1x\n3: 2x\n5: 3x â† most\n7,9: 1x each\n\nANSWER: 5",
    deviation: "SD EXAMPLE:\n\nData: 2,4,6,8,10\n\nMean=6\nDeviations: -4,-2,0,2,4\nSquared: 16,4,0,4,16\nVariance=8\nSD=âˆš8=2.83\n\nANSWER: 2.83",
    variance: "VARIANCE EXAMPLE:\n\nData: 1,3,5,7,9\n\nMean=5\nDeviations: -4,-2,0,2,4\nSquared: 16,4,0,4,16\nSum=40\nVariance=40/5=8\n\nANSWER: 8",
    confidence: "95% CI EXAMPLE:\n\nn=36, xÌ„=78, s=12\n\nz*=1.96\nSE=12/6=2\nME=3.92\nLower=74.08\nUpper=81.92\n\nANSWER: (74.08, 81.92)",
    test: "HYPOTHESIS TEST:\n\nÎ¼>65? Î±=0.05\nn=25, xÌ„=67, s=4\n\nHâ‚€:Î¼=65 Hâ‚:Î¼>65\nt=(67-65)/(4/5)=2.5\nt*=1.711\n2.5>1.711 â†’ REJECT\n\nÎ¼ > 65 âœ“",
    probability: "PROBABILITY:\n\n2 dice, P(sum=7)?\n\nTotal: 36\nSum=7: (1,6)(2,5)(3,4)(4,3)(5,2)(6,1)\nCount: 6\nP=6/36=1/6\n\nANSWER: 0.167",
    correlation: "CORRELATION:\n\nr = 0.85\n\nClose to +1\nSTRONG correlation\nPositive direction\nrÂ²=0.72 (72%)\n\nStrong positive!"
  }
};

function levelUp() {
  questionNum++;
  if (questionNum >= 4) tutorLevel = 3;
  else if (questionNum >= 2) tutorLevel = 2;

  var names = {1: 'Level 1 - Hints', 2: 'Level 2 - Guided Steps', 3: 'Level 3 - Worked Examples'};
  document.getElementById('tutor-level').textContent = names[tutorLevel];
}

function showMsg(who, msg) {
  var box = document.getElementById('tutor-messages');
  var div = document.createElement('div');

  if (who === 'user') {
    div.style.cssText = 'background:#D97D54;color:white;padding:15px;border-radius:10px;margin-bottom:18px;margin-left:18%;';
    div.innerHTML = '<p style="margin:0;"><strong>You:</strong></p><p style="margin:8px 0 0 0;">' + msg + '</p>';
  } else {
    div.style.cssText = 'background:#E7F3FF;border:2px solid #90CAF9;padding:15px;border-radius:10px;margin-bottom:18px;margin-right:18%;';
    div.innerHTML = '<p style="margin:0;"><strong>AI Tutor:</strong></p><p style="margin:8px 0 0 0;white-space:pre-wrap;">' + msg + '</p>';
  }

  box.appendChild(div);
  box.scrollTop = box.scrollHeight;
}

function getReply(q) {
  var lower = q.toLowerCase();
  var r = answers[tutorLevel];

  if (lower.indexOf('mean') >= 0 || lower.indexOf('average') >= 0) return r.mean;
  if (lower.indexOf('median') >= 0) return r.median;
  if (lower.indexOf('mode') >= 0) return r.mode;
  if (lower.indexOf('deviation') >= 0 || lower.indexOf('spread') >= 0) return r.deviation;
  if (lower.indexOf('variance') >= 0) return r.variance;
  if (lower.indexOf('confidence') >= 0 || lower.indexOf('interval') >= 0) return r.confidence;
  if (lower.indexOf('test') >= 0 || lower.indexOf('hypothesis') >= 0) return r.test;
  if (lower.indexOf('probability') >= 0 || lower.indexOf('chance') >= 0) return r.probability;
  if (lower.indexOf('correlation') >= 0) return r.correlation;
  return r.default;
}

function askTutor() {
  var inputBox = document.getElementById('tutor-input');
  var question = inputBox.textContent.trim();

  if (!question || question === 'Type your question here...') {
    alert('Please type a question first!');
    return;
  }

  showMsg('user', question);
  inputBox.textContent = 'Type your question here...';
  levelUp();

  setTimeout(function() {
    var reply = getReply(question);
    showMsg('ai', reply);
  }, 800);
}

// Clear placeholder on click
document.getElementById('tutor-input').onclick = function() {
  if (this.textContent === 'Type your question here...') {
    this.textContent = '';
  }
};

console.log('AI Tutor loaded!');
</script>
